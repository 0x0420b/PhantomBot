(function(){var e=[],s=[],r=[],i=[],t=[],n=$.systemTime();function o(e){return $.list.contains(t,e,0)}function u(e){return e.equalsIgnoreCase($.botName)}function a(e){return e.equalsIgnoreCase($.ownerName)}function g(e){return $.getUserGroupId(e)==0||$.isOwner(e)||$.isBot(e)}function p(e){return $.getUserGroupId(e)<=1||$.isOwner(e)||$.isBot(e)}function d(e){return $.getUserGroupId(e)<=2||$.isOwner(e)||$.isBot(e)}function f(e,s){return $.isAdmin(e)||s!=null&&s!="{}"&&s.get("user-type").equalsIgnoreCase("mod")||$.isMod(e)}function l(e){var s;for(s in r){if(r[s][0].equalsIgnoreCase(e)){return true}}return false}function b(e,s){return s!=null&&s!="{}"&&s.get("subscriber").equalsIgnoreCase("1")||$.isSub(e)}function m(e){return e!=null&&e!="{}"&&e.get("turbo").equalsIgnoreCase("1")||false}function c(e){return $.getUserGroupId(e)==4}function C(e){return $.getUserGroupId(e)==5}function I(e){return $.getUserGroupId(e)<=6||$.isOwner(e)||$.isBot(e)}function h(e){return $.list.contains(s,e.toLowerCase(),0)}function w(e){return $.list.contains(i,e.toLowerCase())}function y(e){e=e.toLowerCase();if($.inidb.exists("group",e)){return parseInt($.inidb.get("group",e))}else{return 7}}function x(e){return $.getGroupNameById($.getUserGroupId(e))}function G(s){s=parseInt(s);if($.inidb.exists("groups",s)){return $.inidb.get("groups",s)}else{return e[7]}}function U(s){var r;for(r in e){if(e[r].toLowerCase().indexOf(s.toLowerCase())){return r}}return 7}function v(e){return parseInt($.inidb.get("grouppoints",$.getUserGroupName(e)))}function M(e,s){if($.userExists(e.toLowerCase())){$.inidb.set("group",e.toLowerCase(),s)}}function L(e,s){$.setUserGroupById(e,$.getGroupIdByName(s))}function q(){var s=$.inidb.GetKeyList("groups",""),r;e=[];for(r in s){e[parseInt(s[r])]=$.inidb.get("groups",s[r])}}function B(e){var s,r=[];for(s in t){if(e){if($.getUserGroupId(t[s][0])<=e){r.push(t[s][0])}}else{r.push(t[s][0])}}return r}function N(e){if($.bot.isModuleEnabled("./handlers/subscribeHandler.js")){if($.inidb.exists("subscribed",e)&&!$.isSub(e)){$.inidb.setIniDbBoolean("subscribed",e,false);if($.inidb.exists("tempsubgroup",e)&&!$.isMod(e)){$.inidb.set("group",e,$.inidb.get("tempsubgroup",e));$.inidb.del("tempsubgroup",e)}else{$.inidb.set("group",e,7)}}}}function O(){if(!e[0]||e[0]!="Caster"){e[0]="Caster";$.inidb.set("grouppoints","Caster","7");$.inidb.set("groups","0","Caster")}if(!e[1]||e[1]!="Administrator"){e[1]="Administrator";$.inidb.set("grouppoints","Administrator","6");$.inidb.set("groups","1","Administrator")}if(!e[2]||e[2]!="Moderator"){e[2]="Moderator";$.inidb.set("grouppoints","Moderator","5");$.inidb.set("groups","2","Moderator")}if(!e[3]||e[3]!="Subscriber"){e[3]="Subscriber";$.inidb.set("grouppoints","Subscriber","4");$.inidb.set("groups","3","Subscriber")}if(!e[4]||e[4]!="Donator"){e[4]="Donator";$.inidb.set("grouppoints","Donator","3");$.inidb.set("groups","4","Donator")}if(!e[5]||e[5]!="Hoster"){e[5]="Hoster";$.inidb.set("grouppoints","Hoster","2");$.inidb.set("groups","5","Hoster")}if(!e[6]||e[6]!="Regular"){e[6]="Regular";$.inidb.set("grouppoints","Regular","1");$.inidb.set("groups","6","Regular")}if(!e[7]||e[7]!="Viewer"){e[7]="Viewer";$.inidb.set("grouppoints","Viewer","0");$.inidb.set("groups","7","Viewer")}}$.bind("ircJoinComplete",function(e){var s=e.getChannel().getNicks().iterator(),r;n=$.systemTime();while(s.hasNext()){r=s.next().toLowerCase();if(!$.userExists(r)){t.push([r,$.systemTime()])}}});$.bind("ircChannelJoin",function(e){var s=e.getUser().toLowerCase();if(!$.user.isKnown(s)){$.setIniDbBoolean("visited",s,true)}n=$.systemTime();if(!$.userExists(s)){t.push([s,$.systemTime()])}});$.bind("ircChannelLeave",function(e){var r=e.getUser().toLowerCase(),i;for(i in t){if(t[i][0].equalsIgnoreCase(r)){t.splice(i,1);N(r)}}for(i in s){if(s[i][0].equalsIgnoreCase(r)){s.splice(i,1);N(r)}}});$.bind("ircChannelUserMode",function(e){var r=e.getUser().toLowerCase(),i;if(e.getMode().equalsIgnoreCase("o")){if(e.getAdd()){if(!$.hasModeO(r)){if($.isOwner(r)){s.push([r,0]);$.inidb.set("group",r,0)}else{if($.isAdmin(r)){s.push([r,1]);$.inidb.set("group",r,1)}else{s.push([r,2]);$.inidb.set("group",r,2)}}}}else{for(i in s){if(s[i][0].equalsIgnoreCase(r)){s.splice(i,1);N(r)}}}}});$.bind("ircPrivateMessage",function(e){var s=e.getSender().toLowerCase(),t=e.getMessage().toLowerCase().trim(),n="the moderators of this room are: ",o,u;if(s.equalsIgnoreCase("jtv")){if(t.indexOf(n)>-1){o=t.replace(n,"").split(", ");i=[];for(u in o){i.push(o[u])}$.saveArray(i,"addons/mods.txt",false)}if(t.indexOf("specialuser")>-1){o=t.split(" ");if(o[2].equalsIgnoreCase("subscriber")){for(u in r){if(r[u][0].equalsIgnoreCase(o[1])){r[u][1]=$.systemTime()+1e4;return}}r.push([o[1],$.systemTime()+1e4]);$.saveArray(r,"addons/subs.txt",false)}}}});$.bind("command",function(s){var r=s.getSender().toLowerCase(),i=s.getCommand(),n=s.getArgs();if(i.equalsIgnoreCase("users")){if(t.length>20){$.say($.whisperPrefix(r)+$.lang.get("permissions.current.listtoolong",t.length))}else{$.say($.whisperPrefix(r)+$.lang.get("permissions.current.users",B().join(", ")))}}if(i.equalsIgnoreCase("mods")){var o=B(2);if(o.length>20){$.say($.whisperPrefix(r)+$.lang.get("permissions.current.listtoolong",o.length))}else{$.say($.whisperPrefix(r)+$.lang.get("permissions.current.mods",o.join(", ")))}}if(i.equalsIgnoreCase("group")){if(!$.isModv3(r,s.getTags())||!n[0]){$.say($.whisperPrefix(r)+$.lang.get("permissions.group.self.current",$.getUserGroupName(r)));return}var u=n[0],a=parseInt(n[1]);if(n.length<2||isNaN(a)||$.outOfRange(a,0,e.length-1)){$.say($.whisperPrefix(r)+$.lang.get("permissions.group.usage"));return}if(a<$.getUserGroupId(r)){$.say($.whisperPrefix(r)+$.lang.get("permissions.group.set.error.abovegroup"));return}if(a==$.getUserGroupId(r)){$.say($.whisperPrefix(r)+$.lang.get("permissions.group.set.error.samegroup"));return}$.inidb.set("group",u.toLowerCase(),a);$.say($.whisperPrefix(r)+$.lang.get("permissions.group.set.success"))}});q();O();$.bind("initReady",function(){$.registerChatCommand("./core/permissions.js","group",7);$.registerChatCommand("./core/permissions.js","users",7);$.registerChatCommand("./core/permissions.js","mods",7)});$.casterMsg=$.lang.get("cmd.casteronly");$.adminMsg=$.lang.get("cmd.adminonly");$.modMsg=$.lang.get("cmd.modonly");$.userGroups=e;$.modeOUsers=s;$.subUsers=r;$.modListUsers=i;$.users=t;$.lastJoinPart=n;$.userExists=o;$.isBot=u;$.isOwner=a;$.isCaster=g;$.isAdmin=p;$.isMod=d;$.isModv3=f;$.isOwner=a;$.isSub=l;$.isSubv3=b;$.isTurbo=m;$.isDonator=c;$.isHoster=C;$.isReg=I;$.hasModeO=h;$.hasModList=w;$.getUserGroupId=y;$.getUserGroupName=x;$.getGroupNameById=G;$.getGroupIdByName=U;$.getGroupPointMultiplier=v;$.setUserGroupById=M;$.setUserGroupByName=L})();