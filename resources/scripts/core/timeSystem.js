(function(){var e=$.inidb.exists("timeSettings","timeLevel")?$.getIniDbBoolean("timeSettings","timeLevel"):false,t=$.inidb.exists("timeSettings","keepTimeWhenOffline")?$.getIniDbBoolean("timeSettings","keepTimeWhenOffline"):false,i=$.inidb.exists("timeSettings","modTimePermToggle")?$.getIniDbBoolean("timeSettings","modTimePermToggle"):false,s=$.inidb.exists("timeSettings","timePromoteHours")?parseInt($.inidb.get("timeSettings","timePromoteHours")):50,r=$.inidb.exists("timeSettings","timeZone")?$.inidb.get("timeSettings","timeZone"):"Europe/Amsterdam",n=6;function a(e){var t=java.util.TimeZone.getAvailableIDs(),i;for(i in t){if(t[i]!=null&&t[i].toLowerCase()==e.toLowerCase()){return true}}return false}function m(e){if(a(e)){r=e;$.inidb.set("timeSettings","timeZone");return true}return false}function o(e){if(i){if(!$.isModv3(e.getSender().toLowerCase(),e.getTags())){return false}}else if(!$.isAdmin(e.getSender().toLowerCase())){return false}return true}function g(e,t){var i=e.getFullYear(),s=e.getMonth()+1,r=e.getDate(),n=e.getHours(),a=e.getMinutes();if(t){return n+":"+a}else{return r+"-"+s+"-"+i+" "+n+":"+a}}function l(e,t){var i=Math.floor,s=e/3600,r=s%1*60;if(t){return i(s)+"hrs "}else{return e>60?(i(s)+"hrs "+i(~~r)+"min ").replace(/^0hrs/,""):i(r%1*60)+"sec"}}function u(e){return $.inidb.exists("time",e)?$.inidb.get("time",e):0}function f(e){return $.getTimeString($.getUserTime(e))}$.bind("command",function(a){var m=a.getSender().toLowerCase(),g=$.username.resolve(m),l=a.getCommand(),u=a.getArgs(),f=u[0],d,y;if(l.equalsIgnoreCase("time")){if(!o(a)||!f){$.say($.whisperPrefix(m)+$.lang.get("timesystem.get.other",$.resolveRank(m),$.getUserTimeString(m)))}else{d=u[1];y=parseInt(u[2]);if(f.equalsIgnoreCase("add")){if(!d||isNaN(y)){$.say($.whisperPrefix(m)+$.lang.get("timesystem.add.usage"));return}d=d.toLowerCase();if(y<0){$.say($.whisperPrefix(m)+$.lang.get("timesystem.add.error.negative"));return}if($.user.isKnown(d)){$.inidb.incr("time",d,y);$.say($.whisperPrefix(m)+$.lang.get("timesystem.add.success",$.getTimeString(y),$.username.resolve(d),$.getUserTimeString(d)))}else{$.say($.whisperPrefix(m)+$.lang.get("common.user.404",$.username.resolve(d)))}}if(f.equalsIgnoreCase("take")){if(!d||isNaN(y)){$.say($.whisperPrefix(m)+$.lang.get("timesystem.take.usage"));return}if($.user.isKnown(m)){$.say($.whisperPrefix(m)+$.lang.get("common.user.404",g))}if(y>$.getUserTime(m)){$.say($.whisperPrefix(m)+$.lang.get("timesystem.take.error.toomuch",g));return}$.inidb.decr("time",d,y);$.say($.whisperPrefix(m)+$.lang.get("timesystem.take.success",$.getTimeString(y),$.username.resolve(d),$.getUserTimeString(m)))}if(f.equalsIgnoreCase("set")){if(!d||isNaN(y)){$.say($.whisperPrefix(m)+$.lang.get("timesystem.settime.usage"));return}if(y<0){$.say($.whisperPrefix(m)+$.lang.get("timesystem.settime.error.negative"));return}if($.user.isKnown(d.toLowerCase())){$.inidb.set("time",d,y);$.say($.whisperPrefix(m)+$.lang.get("timesystem.settime.success",$.username.resolve(d),$.getUserTimeString(d.toLowerCase())))}else{$.say($.whisperPrefix(m)+$.lang.get("common.user.404",d))}}if(f.equalsIgnoreCase("promotehours")){if(isNaN(d)){$.say($.whisperPrefix(m)+$.lang.get("timesystem.set.promotehours.usage"));return}if(d<0){$.say($.whisperPrefix(m)+$.lang.get("timesystem.set.promotehours.error.negative",$.getGroupNameById(n).toLowerCase()));return}$.inidb.set("settings","timePromoteHours",u[1]);s=parseInt($.inidb.get("settings","timePromoteHours"));$.say($.whisperPrefix(m)+$.lang.get("timesystem.set.promotehours.success",$.getGroupNameById(n).toLowerCase(),s))}if(f.equalsIgnoreCase("autolevel")){e=!e;$.setIniDbBoolean("timeSettings","timeLevel",e);if(e){$.say($.whisperPrefix(m)+$.lang.get("timesystem.autolevel.enabled",$.getGroupNameById(n).toLowerCase(),s))}else{$.say($.whisperPrefix(m)+$.lang.get("timesystem.autolevel.disabled",$.getGroupNameById(n).toLowerCase(),s))}}if(f.equalsIgnoreCase("offline")||f.equalsIgnoreCase("offlinetime")){t=!t;$.setIniDbBoolean("timeSettings","keepTimeWhenOffline",t);if(t){$.say($.whisperPrefix(m)+$.lang.get("timesystem.offlinetime.enabled"))}else{$.say($.whisperPrefix(m)+$.lang.get("timesystem.offlinetime.disabled"))}}if(f.equalsIgnoreCase("modpermtoggle")){i=!i;$.setIniDbBoolean("timeSettings","modTimePermToggle",i);$.say($.whisperPrefix(m)+$.lang.get("timesystem.modpermtoggle.success",i?"Moderator":"Administrator"))}if(f.equalsIgnoreCase("help")){$.say($.whisperPrefix(m)+$.lang.get("timesystem.help"))}}}if(l.equalsIgnoreCase("streamertime")){var p=java.util.Calendar.getInstance(java.util.TimeZone.getTimeZone(r)),h=p.getTime(),w=new java.text.SimpleDateFormat("EEEE MMMM d, yyyy @ h:mm a z");w.setTimeZone(java.util.TimeZone.getTimeZone(r));$.say($.whisperPrefix(m)+$.lang.get("timesystem.streamertime",w.format(h),$.username.resolve($.ownerName)))}});setInterval(function(){var i;if(!$.bot.isModuleEnabled("./core/timeSystem.js")){return}if($.isOnline($.channelName)||t){for(i in $.users){$.inidb.incr("time",$.users[i][0].toLowerCase(),60)}}if(e){for(i in $.users){var r=$.users[i][0].toLowerCase();if(!$.isMod(r)&&$.inidb.exists("time",r)&&parseInt($.inidb.get("time",r))*60>s&&parseInt($.getUserGroupId(r)>n)){$.setUserGroupById(r,n);$.say($.whisperPrefix(r)+$.lang.get("timesystem.autolevel.promoted",$.username.resolve(r),$.getGroupNameById(n).toLowerCase(),s))}}}},6e4);$.bind("initReady",function(){if($.bot.isModuleEnabled("./core/timeSystem.js")){$.registerChatCommand("./core/timeSystem.js","time");$.registerChatCommand("./core/timeSystem.js","streamertime")}});$.dateToString=g;$.getTimeString=l;$.getUserTime=u;$.getUserTimeString=f})();