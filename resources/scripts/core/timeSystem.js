(function(){var e=$.inidb.exists("timeSettings","timeLevel")?$.getIniDbBoolean("timeSettings","timeLevel"):false,t=$.inidb.exists("timeSettings","keepTimeWhenOffline")?$.getIniDbBoolean("timeSettings","keepTimeWhenOffline"):false,i=$.inidb.exists("timeSettings","modTimePermToggle")?$.getIniDbBoolean("timeSettings","modTimePermToggle"):false,s=$.inidb.exists("timeSettings","timePromoteHours")?parseInt($.inidb.get("timeSettings","timePromoteHours")):50,r=6;function n(e){var t=java.util.TimeZone.getAvailableIDs(),i;for(i in t){if(t[i]!=null&&t[i].toLowerCase()==e.toLowerCase()){return true}}return false}function a(e){if(i){if(!$.isModv3(e.getSender().toLowerCase(),e.getTags())){return false}}else if(!$.isAdmin(e.getSender().toLowerCase())){return false}return true}function o(e,t){var i=e.getFullYear(),s=e.getMonth()+1,r=e.getDate(),n=e.getHours(),a=e.getMinutes();if(t){return n+":"+a}else{return r+"-"+s+"-"+i+" "+n+":"+a}}function m(e,t){var i=Math.floor,s=e/3600,r=s%1*60;if(t){return i(s)+"hrs "}else{return e>60?(i(s)+"hrs "+i(~~r)+"min ").replace(/^0hrs/,""):i(r%1*60)+"sec"}}function g(e){return $.inidb.exists("time",e)?$.inidb.get("time",e):0}function l(e){return $.getTimeString($.getUserTime(e))}$.bind("command",function(n){var o=n.getSender().toLowerCase(),m=$.username.resolve(o),g=n.getCommand(),l=n.getArgs(),u=l[0],f,d;if(g.equalsIgnoreCase("time")){if(!a(n)||!u){$.say($.whisperPrefix(o)+$.lang.get("timesystem.get.other",$.resolveRank(o),$.getUserTimeString(o)))}else{f=l[1];d=parseInt(l[2]);if(u.equalsIgnoreCase("add")){if(!f||isNaN(d)){$.say($.whisperPrefix(o)+$.lang.get("timesystem.add.usage"));return}f=f.toLowerCase();if(d<0){$.say($.whisperPrefix(o)+$.lang.get("timesystem.add.error.negative"));return}if($.user.isKnown(f)){$.inidb.incr("time",f,d);$.say($.whisperPrefix(o)+$.lang.get("timesystem.add.success",$.getTimeString(d),$.username.resolve(f),$.getUserTimeString(f)))}else{$.say($.whisperPrefix(o)+$.lang.get("common.user.404",$.username.resolve(f)))}}if(u.equalsIgnoreCase("take")){if(!f||isNaN(d)){$.say($.whisperPrefix(o)+$.lang.get("timesystem.take.usage"));return}if($.user.isKnown(o)){$.say($.whisperPrefix(o)+$.lang.get("common.user.404",m))}if(d>$.getUserTime(o)){$.say($.whisperPrefix(o)+$.lang.get("timesystem.take.error.toomuch",m));return}$.inidb.decr("time",f,d);$.say($.whisperPrefix(o)+$.lang.get("timesystem.take.success",$.getTimeString(d),$.username.resolve(f),$.getUserTimeString(o)))}if(u.equalsIgnoreCase("set")){if(!f||isNaN(d)){$.say($.whisperPrefix(o)+$.lang.get("timesystem.settime.usage"));return}if(d<0){$.say($.whisperPrefix(o)+$.lang.get("timesystem.settime.error.negative"));return}if($.user.isKnown(f.toLowerCase())){$.inidb.set("time",f,d);$.say($.whisperPrefix(o)+$.lang.get("timesystem.settime.success",$.username.resolve(f),$.getUserTimeString(f.toLowerCase())))}else{$.say($.whisperPrefix(o)+$.lang.get("common.user.404",f))}}if(u.equalsIgnoreCase("promotehours")){if(isNaN(f)){$.say($.whisperPrefix(o)+$.lang.get("timesystem.set.promotehours.usage"));return}if(f<0){$.say($.whisperPrefix(o)+$.lang.get("timesystem.set.promotehours.error.negative",$.getGroupNameById(r).toLowerCase()));return}$.inidb.set("settings","timePromoteHours",l[1]);s=parseInt($.inidb.get("settings","timePromoteHours"));$.say($.whisperPrefix(o)+$.lang.get("timesystem.set.promotehours.success",$.getGroupNameById(r).toLowerCase(),s))}if(u.equalsIgnoreCase("autolevel")){e=!e;$.setIniDbBoolean("timeSettings","timeLevel",e);if(e){$.say($.whisperPrefix(o)+$.lang.get("timesystem.autolevel.enabled",$.getGroupNameById(r).toLowerCase(),s))}else{$.say($.whisperPrefix(o)+$.lang.get("timesystem.autolevel.disabled",$.getGroupNameById(r).toLowerCase(),s))}}if(u.equalsIgnoreCase("offline")||u.equalsIgnoreCase("offlinetime")){t=!t;$.setIniDbBoolean("timeSettings","keepTimeWhenOffline",t);if(t){$.say($.whisperPrefix(o)+$.lang.get("timesystem.offlinetime.enabled"))}else{$.say($.whisperPrefix(o)+$.lang.get("timesystem.offlinetime.disabled"))}}if(u.equalsIgnoreCase("modpermtoggle")){i=!i;$.setIniDbBoolean("timeSettings","modTimePermToggle",i);$.say($.whisperPrefix(o)+$.lang.get("timesystem.modpermtoggle.success",i?"Moderator":"Administrator"))}if(u.equalsIgnoreCase("help")){$.say($.whisperPrefix(o)+$.lang.get("timesystem.help"))}}}if(g.equalsIgnoreCase("streamertime")){$.say($.whisperPrefix(o)+$.lang.get("timesystem.streamertime",(new Date).toLocaleString("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:true}),$.username.resolve($.ownerName)))}});setInterval(function(){var i;if(!$.bot.isModuleEnabled("./core/timeSystem.js")){return}if($.isOnline($.channelName)||t){for(i in $.users){$.inidb.incr("time",$.users[i][0].toLowerCase(),60)}}if(e){for(i in $.users){var n=$.users[i][0].toLowerCase();if(!$.isMod(n)&&$.inidb.exists("time",n)&&parseInt($.inidb.get("time",n))*60>s&&parseInt($.getUserGroupId(n)>r)){$.setUserGroupById(n,r);$.say($.whisperPrefix(n)+$.lang.get("timesystem.autolevel.promoted",$.username.resolve(n),$.getGroupNameById(r).toLowerCase(),s))}}}},6e4);$.bind("initReady",function(){if($.bot.isModuleEnabled("./core/timeSystem.js")){$.registerChatCommand("./core/timeSystem.js","time");$.registerChatCommand("./core/timeSystem.js","streamertime")}});$.dateToString=o;$.getTimeString=m;$.getUserTime=g;$.getUserTimeString=l})();