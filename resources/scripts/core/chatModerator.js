(function(){var e=[],r=[],t=[],a=[],s=[],o=$.inidb.exists("chatModerator","linksToggle")?$.getIniDbBoolean("chatModerator","linksToggle"):true,n=$.inidb.exists("chatModerator","linksMessage")?$.inidb.get("chatModerator","linksMessage"):"you were timed out for linking",g=parseInt($.inidb.exists("chatModerator","linkPermitTime"))?parseInt($.getIniDbBoolean("chatModerator","linkPermitTime")):120,l=$.inidb.exists("chatModerator","capsToggle")?$.getIniDbBoolean("chatModerator","capsToggle"):true,d=$.inidb.exists("chatModerator","capsMessage")?$.inidb.get("chatModerator","capsMessage"):"you were timed out for overusing caps",h=parseInt($.inidb.exists("chatModerator","capsLimit"))?parseInt($.getIniDbBoolean("chatModerator","capsLimit")):30,u=parseInt($.inidb.exists("chatModerator","capsTriggerLength"))?parseInt($.getIniDbBoolean("chatModerator","capsTriggerLength")):0,c=$.inidb.exists("chatModerator","spamToggle")?$.getIniDbBoolean("chatModerator","spamToggle"):true,f=$.inidb.exists("chatModerator","spamMessage")?$.inidb.get("chatModerator","spamMessage"):"you were timed out for spamming",p=parseInt($.inidb.exists("chatModerator","spamLimit"))?parseInt($.getIniDbBoolean("chatModerator","spamLimit")):10,m=$.inidb.exists("chatModerator","symbolsToggle")?$.getIniDbBoolean("chatModerator","symbolsToggle"):true,M=$.inidb.exists("chatModerator","symbolsMessage")?$.inidb.get("chatModerator","symbolsMessage"):"you were timed out for overusing symbols",b=parseInt($.inidb.exists("chatModerator","symbolsLimit"))?parseInt($.getIniDbBoolean("chatModerator","symbolsLimit")):10,y=parseInt($.inidb.exists("chatModerator","symbolsTriggerLength"))?parseInt($.getIniDbBoolean("chatModerator","symbolsTriggerLength")):0,w=$.inidb.exists("chatModerator","regularsToggle")?$.getIniDbBoolean("chatModerator","regularsToggle"):false,x=$.inidb.exists("chatModerator","subscribersToggle")?$.getIniDbBoolean("chatModerator","subscribersToggle"):true,I=$.inidb.exists("chatModerator","blacklistMessage")?$.inidb.get("chatModerator","blacklistMessage"):"you were timed out using a blacklisted phrase",P=parseInt($.inidb.exists("chatModerator","warningTime"))?parseInt($.getIniDbBoolean("chatModerator","warningTime")):10,C=parseInt($.inidb.exists("chatModerator","timeoutTime"))?parseInt($.getIniDbBoolean("chatModerator","timeoutTime")):600;function T(){var e=$.inidb.GetKeyList("blacklist","");for(var r in e){s.push($.inidb.get("blacklist",e[r]))}}function k(){var e=$.inidb.GetKeyList("whitelist","");for(var r in e){a.push($.inidb.get("whitelist",e[r]))}}function q(e,r){$.say(".timeout "+e+" "+r);setTimeout(function(){$.say(".timeout "+e+" "+r)},1e3)}function L(e){for(var t in r){if(r[t].equalsIgnoreCase(e)){q(e,C);D(e);warning="(timeout)";return}}q(e,P);D(e);warning="(warning)";return}function v(e,r){if(t.length<=1){$.say("@"+$.username.resolve(e)+", "+r+" "+warning);return}}function D(e){r.push(e);t.push($.systemTime());B(e)}function B(e){var a=setTimeout(function(){for(var e in t){t.splice(0);break}clearTimeout(a)},30*1e3);var s=setTimeout(function(){for(i in r){if(r[i].equalsIgnoreCase(e)){r.splice(i,0);break}}clearTimeout(s)},60*60*1e3)}function _(r){e.push(r);var t=setTimeout(function(){for(var a in e){if(e[a].equalsIgnoreCase(r)){e.splice(a,1);break}}clearTimeout(t)},g*1e3)}function S(e){return e?"enabled":"disabled"}$.bind("ircChannelMessage",function(r){var t=r.getSender(),i=r.getMessage();if(!$.isModv3(t,r.getTags())&&(x||!$.isSubv3(t,r.getTags()))){for(var g in s){if(i.contains(s[g])){$.timeoutUser(t,C);$.sendMessage(t,I);return}}if(o&&$.patternDetector.hasLinks(r)){for(g in e){if(e[g].equalsIgnoreCase(t)&&$.patternDetector.hasLinks(r)){e.splice(g,1);return}}for(g in a){if(i.contains(a[g])){return}}if(w&&$.getUserGroupId(t)<=6){return}$.deleteMessage(t);$.sendMessage(t,n);return}if(l&&i.length()>u){if(r.getCapsCount()>h){$.deleteMessage(t);$.sendMessage(t,d);return}}if(m&&i.length()>y){if($.patternDetector.getNumberOfNonLetters(r)>b){$.deleteMessage(t);$.sendMessage(t,M);return}}if(c){if($.patternDetector.getLongestRepeatedSequence(r)>p){$.deleteMessage(t);$.sendMessage(t,f);return}}}});$.bind("command",function(e){var r=e.getSender(),t=e.getCommand(),i=e.getArguments(),q=e.getArgs(),L=q[0],v=q[1];if(t.equalsIgnoreCase("permit")){if(!$.isModv3(r,e.getTags())){$.say($.whisperPrefix(r)+$.modMsg);return}else if(!L){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.permit.usage"));return}$.permitUser(L);$.say($.username.resolve(L)+$.lang.get("chatModerator.permited",g));return}if(t.equalsIgnoreCase("blacklist")){if(!$.isModv3(r,e.getTags())){$.say($.whisperPrefix(r)+$.modMsg);return}if(!L){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.blacklist.usage"));return}if(L.equalsIgnoreCase("add")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.blacklist.add.usage"));return}var D=i.replace(L,"").trim();$.inidb.set("blackList","phrase_"+s.length,D);s.push(D);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.blacklist.added"));return}if(L.equalsIgnoreCase("remove")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.blacklist.remove.usage"));return}else if(!$.inidb.exists("blackList","phrase_"+parseInt(v))){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.err"));return}$.inidb.del("blackList","phrase_"+parseInt(v));T();$.say($.whisperPrefix(r)+$.lang.get("chatModerator.blacklist.removed"))}if(L.equalsIgnoreCase("show")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.blacklist.show.usage"));return}else if(!$.inidb.exists("blackList","phrase_"+parseInt(v))){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.err"));return}$.say($.whisperPrefix(r)+$.inidb.get("blackList","phrase_"+parseInt(v)));return}}if(t.equalsIgnoreCase("whiteList")){if(!$.isModv3(r,e.getTags())){$.say($.whisperPrefix(r)+$.modMsg);return}if(!L){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.whitelist.usage"));return}if(L.equalsIgnoreCase("add")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.whitelist.add.usage"));return}var B=i.replace(L,"").trim();$.inidb.set("whiteList","link_"+a.length,B);a.push(B);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.whitelist.link.added"));return}if(L.equalsIgnoreCase("remove")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.whitelist.remove.usage"));return}else if(!$.inidb.exists("whiteList","link_"+parseInt(v))){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.err"));return}$.inidb.del("whiteList","link_"+parseInt(v));k();$.say($.whisperPrefix(r)+$.lang.get("chatModerator.whitelist.removed"));return}if(L.equalsIgnoreCase("show")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.whitelist.show.usage"));return}if(!$.inidb.exists("whiteList","link_"+parseInt(v))){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.err"));return}$.say($.whisperPrefix(r)+$.inidb.get("whiteList","link_"+parseInt(v)));return}}if(t.equalsIgnoreCase("moderation")){if(!$.isAdmin(r)){$.say($.whisperPrefix(r)+$.adminMsg);return}if(!L){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.usage.toggles"));$.say($.whisperPrefix(r)+$.lang.get("chatModerator.usage.messages"));$.say($.whisperPrefix(r)+$.lang.get("chatModerator.options"));return}if(L.equalsIgnoreCase("links")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.link.usage",$.getModerationFilterStatus(o)));return}if(v.equalsIgnoreCase("on")){o=true;$.inidb.set("chatModerator","linksToggle",o);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.link.filter.enabled"));return}else if(v.equalsIgnoreCase("off")){o=false;$.inidb.set("chatModerator","linksToggle",o);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.link.filter.disabled"));return}}if(L.equalsIgnoreCase("caps")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.caps.usage",$.getModerationFilterStatus(l)));return}if(v.equalsIgnoreCase("on")){l=true;$.inidb.set("chatModerator","capsToggle",l);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.caps.filter.enabled"));return}else if(v.equalsIgnoreCase("off")){l=false;$.inidb.set("chatModerator","capsToggle",l);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.caps.filter.disabled"));return}}if(L.equalsIgnoreCase("spam")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.spam.usage",$.getModerationFilterStatus(c)));return}if(v.equalsIgnoreCase("on")){c=true;$.inidb.set("chatModerator","spamToggle",c);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.spam.filter.enabled"));return}else if(v.equalsIgnoreCase("off")){c=false;$.inidb.set("chatModerator","spamToggle",c);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.spam.filter.disabled"));return}}if(L.equalsIgnoreCase("symbols")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.symbols.usage",$.getModerationFilterStatus(m)));return}if(v.equalsIgnoreCase("on")){m=true;$.inidb.set("chatModerator","symbolsToggle",m);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.symbols.filter.enabled"));return}else if(v.equalsIgnoreCase("off")){m=false;$.inidb.set("chatModerator","symbolsToggle",m);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.symbols.filter.disabled"));return}}if(L.equalsIgnoreCase("regulars")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.regulars.usage"));return}if(v.equalsIgnoreCase("true")){w=true;$.inidb.set("chatModerator","regularsToggle",w);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.regulars.enabled"));return}else if(v.equalsIgnoreCase("false")){w=false;$.inidb.set("chatModerator","regularsToggle",w);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.regulars.disabled"));return}}if(L.equalsIgnoreCase("subscribers")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.subscribers.usage"));return}if(v.equalsIgnoreCase("true")){x=true;$.inidb.set("chatModerator","subscribersToggle",x);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.subscribers.enabled"));return}else if(v.equalsIgnoreCase("false")){x=false;$.inidb.set("chatModerator","subscribersToggle",x);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.subscribers.disabled"));return}}if(L.equalsIgnoreCase("linksmessage")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.link.message.usage"));return}n=i.replace(L,"").trim();$.inidb.set("chatModerator","linksMessage",n);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.link.message.set",n));return}if(L.equalsIgnoreCase("capsmessage")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.caps.message.usage"));return}d=i.replace(L,"").trim();$.inidb.set("chatModerator","capsMessage",d);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.caps.message.set",d));return}if(L.equalsIgnoreCase("symbolsmessage")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.symbols.message.usage"));return}M=i.replace(L,"").trim();$.inidb.set("chatModerator","symbolsMessage",M);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.symbols.message.set",M));return}if(L.equalsIgnoreCase("spammessage")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.spam.message.usage"));return}f=i.replace(L,"").trim();$.inidb.set("chatModerator","spamMessage",f);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.spam.message.set",f));return}if(L.equalsIgnoreCase("blacklistmessage")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.blacklist.message.usage"));return}I=i.replace(L,"").trim();$.inidb.set("chatModerator","blacklistMessage",I);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.blacklist.message.set",I));return}if(L.equalsIgnoreCase("permittime")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.permit.time.usage"));return}g=parseInt(v);$.inidb.set("chatModerator","linkPermitTime",g);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.permit.time.set",g));return}if(L.equalsIgnoreCase("capslimit")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.caps.limit.usage"));return}h=parseInt(v);$.inidb.set("chatModerator","capsLimit",h);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.caps.limit.set",h));return}if(L.equalsIgnoreCase("capstriggerlength")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.caps.trigger.length.usage"));return}u=parseInt(v);$.inidb.set("chatModerator","capsTriggerLength",u);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.caps.trigger.length.set",h));return}if(L.equalsIgnoreCase("spamlimit")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.spam.limit.usage"));return}p=parseInt(v);$.inidb.set("chatModerator","spamLimit",p);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.spam.limit.set",p));return}if(L.equalsIgnoreCase("symbolslimit")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.symbols.limit.usage"));return}b=parseInt(v);$.inidb.set("chatModerator","symbolsLimit",b);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.symbols.limit.set",b));return}if(L.equalsIgnoreCase("symbolsTriggerLength")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.symbols.trigger.length.usage"));return}y=parseInt(v);$.inidb.set("chatModerator","symbolsTriggerLength",y);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.symbols.trigger.length.set",y));return}if(L.equalsIgnoreCase("timeoutime")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.timeout.time.usage"));return}C=parseInt(v);$.inidb.set("chatModerator","timeoutTime",C);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.timeout.time.set",C));return}if(L.equalsIgnoreCase("warningtime")){if(!v){$.say($.whisperPrefix(r)+$.lang.get("chatModerator.warning.time.usage"));return}P=parseInt(v);$.inidb.set("chatModerator","warningTime",P);$.say($.whisperPrefix(r)+$.lang.get("chatModerator.warning.time.set",P));return}}});$.bind("initReady",function(){if($.bot.isModuleEnabled("./core/chatModerator.js")){$.registerChatCommand("./core/chatModerator.js","permit",1);$.registerChatCommand("./core/chatModerator.js","moderation",1);$.registerChatCommand("./core/chatModerator.js","blacklist",1);$.registerChatCommand("./core/chatModerator.js","whitelist",1);k();T()}});$.timeoutUser=q;$.deleteMessage=L;$.sendMessage=v;$.setTimeoutAndCooldown=D;$.clearTimeouts=B;$.permitUser=_;$.getModerationFilterStatus=S})();