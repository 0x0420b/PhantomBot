(function(){var e=["cat","dog","horse","llama","panda","bunny"],t={buyNewTG:$.inidb.exists("tamagotchiSettings","pricingBuyNewTG")?parseInt($.inidb.get("tamagotchi_settings","pricingBuyNewTG")):1e3,buyFood:$.inidb.exists("tamagotchiSettings","pricingBuyFood")?parseInt($.inidb.get("tamagotchi_settings","pricingBuyFood")):5},i=$.inidb.exists("tamagotchiSettings","foodLevelTTLHrs")?parseInt($.inidb.get("tamagotchi_settings","foodLevelTTLHrs")):24,a=$.inidb.exists("tamagotchiSettings","foodMax")?parseInt($.inidb.get("tamagotchi_settings","foodMax")):30,n=$.inidb.exists("tamagotchiSettings","generalLevelCap")?parseInt($.inidb.get("tamagotchi_settings","generalLevelCap")):100;function s(e,a,s,g,r,h,l,u){this.owner=(e+"").toLowerCase();this.type=(a+"").toLowerCase();this.name=s+"";this.dob=isNaN(g)?$.systemTime():g;this.foodLevel=isNaN(r)?7:r;this.funLevel=isNaN(h)?3:h;this.expLevel=isNaN(l)?0:l;this.sex=!isNaN(u)?u:$.rand(50)>25?0:1;this.growOneHour=function(){var e=1/i,t=1/(i/2);this.decrFunLevel(t).decrFoodLevel(e);if(this.foodLevel<=0){this.kill()}return this};this.kill=function(){$.inidb.del("tamagotchi",this.owner);$.inidb.SaveAll(true);$.say($.whisperPrefix(this.owner)+$.lang.get("tamagotchi.died",this.name,o(),$.getPointsString(t.buyNewTG)));return this};this.getAgeInSeconds=function(){return($.systemTime()-this.dob)/1e3};this.getSexString=function(){return $.lang.get(this.sex==1?"tamagotchi.sex.male":"tamagotchi.sex.female")};this.isHappy=function(e){return this.funLevel>=(e?1:7)};this.save=function(){$.inidb.set("tamagotchi",this.owner,JSON.stringify({owner:this.owner,type:this.type,name:this.name,dob:this.dob,foodLevel:this.foodLevel,funLevel:this.funLevel,expLevel:this.expLevel,sex:this.sex}));return this};this.incrFoodLevel=function(e){this.foodLevel+=e;$.say($.whisperPrefix(this.owner)+$.lang.get("tamagotchi.foodgiven",this.name,e,$.getTimeString(e*f())));return this};this.decrFoodLevel=function(e){this.foodLevel-=e;if(this.foodLevel>=0&&this.foodLevel<=.05){$.say($.whisperPrefix(this.owner)+$.lang.get("tamagotchi.needsfood",this.name,this.getSexString()))}return this};this.incrFunLevel=function(e){this.funLevel+=e;if(this.funLevel>n/2){this.funLevel=n/2}return this};this.decrFunLevel=function(e){this.funLevel-=e;if(this.funLevel<0){this.funLevel=0}return this};this.incrExpLevel=function(e){this.expLevel+=e;if(this.expLevel>n){this.expLevel=n}return this};this.sayAge=function(){$.say($.lang.get("tamagotchi.showage",$.resolveRank(this.owner),this.name,$.getTimeString(this.getAgeInSeconds()),Math.round(this.foodLevel)));return this};this.sayExpLevel=function(){$.say($.lang.get("tamagotchi.explevel",this.name,Math.floor(this.expLevel)));return this};this.sayFunLevel=function(){if(this.funLevel>7){$.say($.lang.get("tamagotchi.funlevel.ishappy",this.name))}else if(this.funLevel>0){$.say($.lang.get("tamagotchi.funlevel.ismeh",this.name,this.getSexString()))}else{$.say($.lang.get("tamagotchi.funlevel.issad",this.name,this.getSexString()))}return this};this.sayFoodLevelTooLow=function(){$.say($.lang.get("tamagotchi.foodlow",this.name));return this}}function o(){return'"'+e.join('", "')+'"'}function g(t){for(var i in e){if(e[i].equalsIgnoreCase(t)){return true}}return false}function r(e){if(!h(e)){return null}var t=JSON.parse($.inidb.get("tamagotchi",e.toLowerCase()));return new s(t.owner,t.type,t.name,t.dob,t.foodLevel,t.funLevel,t.expLevel,t.sex)}function h(e){return $.inidb.exists("tamagotchi",e.toLowerCase())}function l(e){$.say($.whisperPrefix(e)+$.lang.get("tamagotchi.404",o(),$.getPointsString(t.buyNewTG)))}function u(e,t){$.say($.whisperPrefix(e)+$.lang.get("tamagotchi.404foruser",$.resolveRank(t)))}function f(){return i*3600}$.bind("command",function(e){var i=e.getCommand(),n=e.getSender().toLowerCase(),u=$.getUserPoints(n),c=e.getArgs();if(i.equalsIgnoreCase("tamagotchi")){if(c.length>0){if(h(c[0])){r(c[0]).sayAge().sayFunLevel().sayExpLevel()}else{$.say($.whisperPrefix(n)+$.lang.get("tamagotchi.404foruser",$.username.resolve(c[0])))}return}if(h(n)){r(n).sayAge().sayFunLevel().sayExpLevel()}else{l(n)}}if(i.equalsIgnoreCase("tgbuy")){if(c.length<2||!g(c[0])){$.say($.whisperPrefix(n)+$.lang.get("tamagotchi.buytamagotchi.usage",o(),$.getPointsString(t.buyNewTG)));return}if(u<t.buyNewTG){$.say($.whisperPrefix(n)+$.lang.get("tamagotchi.buytamagotchi.needpoints",$.pointNameMultiple,$.getPointsString(t.buyNewTG)));return}if(h(n)){$.say($.whisperPrefix(n)+$.lang.get("tamagotchi.buytamagotchi.alreadyown"));return}if($.strlen(c[1])>13){$.say($.whisperPrefix(n)+$.lang.get("tamagotchi.buytamagotchi.nametoolong"));return}var m=new s(n,c[0],c[1]).save();$.say($.lang.get("tamagotchi.bought",$.resolveRank(n),m.getSexString(),m.type,m.name));m.sayAge().sayFunLevel()}if(i.equalsIgnoreCase("tgfeed")){if(c.length<1||isNaN(parseInt(c[0]))){$.say($.whisperPrefix(n)+$.lang.get("tamagotchi.feedtamagotchi.usage",$.getPointsString(t.buyFood),$.getTimeString(f(),true)));return}var d=parseInt(c[0]);var v=r(n);if(u<t.buyFood*d){$.say($.whisperPrefix(n)+$.lang.get("tamagotchi.feedtamagotchi.needpoints",$.pointNameMultiple,$.getPointsString(t.buyFood)));return}if(!v){$.say($.whisperPrefix(n)+$.lang.get("tamagotchi.404",o(),$.getPointsString(t.buyNewTG)));return}if(v.foodLevel+d>a+Math.floor(v.expLevel)){$.say($.whisperPrefix(n)+$.lang.get("tamagotchi.feedtamagotchi.maxreached",v.name,a));return}$.inidb.decr("points",n,d*t.buyFood);v.incrFoodLevel(d).save()}if(i.equalsIgnoreCase("tgkill")){var y=r(n);if(!y){$.say($.whisperPrefix(n)+$.lang.get("tamagotchi.buytamagotchi.usage",o(),$.getPointsString(t.buyNewTG)));return}y.kill()}});setInterval(function(){var e=$.inidb.GetKeyList("tamagotchi","");for(var t in e){r(e[t]).growOneHour().save()}},36e5);$.bind("initReady",function(){if($.bot.isModuleEnabled("./games/tamagotchi.js")){$.registerChatCommand("./games/tamagotchi.js","tamagotchi",6);$.registerChatCommand("./games/tamagotchi.js","tgbuy",6);$.registerChatCommand("./games/tamagotchi.js","tgfeed",6);$.registerChatCommand("./games/tamagotchi.js","tgkill",6)}$.consoleLn($.lang.get("tamagotchi.console.loaded",$.inidb.GetKeyList("tamagotchi","").length))});$.tamagotchi={getByOwner:r,tgExists:h,say404:l,sayTarget404:u,foodLevelTTLHrsToSec:f}})();