(function(){var e=$.inidb.exists("commandTimerSettings","requiredMsgs")?parseInt($.inidb.get("commandTimerSettings","requiredMsgs")):10,n=$.inidb.exists("commandTimerSettings","intervalSec")?parseInt($.inidb.get("commandTimerSettings","intervalSec")):600,i=$.inidb.exists("commandTimerSettings","randomize")?$.getIniDbBoolean("commandTimerSettings","randomize"):true,t=$.inidb.exists("commandTimerSettings","active")?$.getIniDbBoolean("commandTimerSettings","active"):true,m=[],s=-1,a=0,r=0;function o(){var e=$.inidb.GetKeyList("commandTimer",""),n;m=[];for(n in e){m.push(e[n])}$.consoleLn($.lang.get("commandtimer.console.loaded",m.length));return m.length}function d(){t=!t;$.setIniDbBoolean("commandTimerSettings","active",t);return t}function g(){i=!i;$.setIniDbBoolean("commandTimerSettings","randomize",i);return i}function c(e){$.setIniDbBoolean("commandTimer",e,true);return o()}function l(e){$.inidb.del("commandTimer",e);return o()}$.bind("ircChannelMessage",function(t){var o=$.systemTime(),d;if(t.getSender().equalsIgnoreCase($.botName)){return}++a;if(a>=e){if(o>r+n*1e3){a=0;r=o+n*1e3;if(i){do{d=$.rand(m.length-1)}while(d==s)}else{if(s+1>=m.length){d=0}else{d=s+1}}s=d;Packages.me.mast3rplan.phantombot.event.EventBus.instance().post(new Packages.me.mast3rplan.phantombot.event.command.CommandEvent($.botName,m[d],""))}}});$.bind("command",function(m){var s=m.getSender(),a=m.getCommand(),r=m.getArgs(),o=r[0],u;if(a.equalsIgnoreCase("addcommandtimer")){if(!o){$.say($.whisperPrefix(s)+$.lang.get("commandtimer.add.usage"));return}c(o);$.say($.whisperPrefix(s)+$.lang.get("commandtimer.add.success",o));return}if(a.equalsIgnoreCase("delcommandtimer")){if(!o){$.say($.whisperPrefix(s)+$.lang.get("commandtimer.del.usage"));return}l(o);$.say($.whisperPrefix(s)+$.lang.get("commandtimer.del.success",o));return}if(a.equalsIgnoreCase("commandtimer")){if(o.equalsIgnoreCase("toggle")){d();$.say($.whisperPrefix(s)+$.lang.get("commandtimer.toggle.success",t?$.lang.get("common.enabled"):$.lang.get("common.disabled")));return}if(o.equalsIgnoreCase("togglerandom")){g();$.say($.whisperPrefix(s)+$.lang.get("commandtimer.togglerandom.success",i?$.lang.get("common.enabled"):$.lang.get("common.disabled")));return}if(o.equalsIgnoreCase("settime")){u=parseInt(r[1]);if(!r[1]||isNaN(u)){$.say($.whisperPrefix(s)+$.lang.get("commandtimer.settime.usage"));return}n=u;$.inidb.set("commandTimerSettings","intervalSec",u);$.say($.whisperPrefix(s)+$.lang.get("commandtimer.settime.success",u));return}if(o.equalsIgnoreCase("setreqmsgs")){u=parseInt(r[1]);if(!r[1]||isNaN(u)){$.say($.whisperPrefix(s)+$.lang.get("commandtimer.setreqmsgs.usage"));return}e=u;$.inidb.set("commandTimerSettings","requiredMsgs",u);$.say($.whisperPrefix(s)+$.lang.get("commandtimer.setreqmsgs.success",u))}}});$.bind("initReady",function(){if($.bot.isModuleEnabled("./systems/commandTimer.js")){o();$.registerChatCommand("./systems/commandTimer.js","addcommandtimer",1);$.registerChatCommand("./systems/commandTimer.js","delcommandtimer",1);$.registerChatCommand("./systems/commandTimer.js","commandtimer",1)}})})();