(function(){var e=$.inidb.exists("commandTimerSettings","requiredMsgs")?parseInt($.inidb.get("commandTimerSettings","requiredMsgs")):10,n=$.inidb.exists("commandTimerSettings","intervalSec")?parseInt($.inidb.get("commandTimerSettings","intervalSec")):600,i=$.inidb.exists("commandTimerSettings","randomize")?$.getIniDbBoolean("commandTimerSettings","randomize"):true,t=$.inidb.exists("commandTimerSettings","active")?$.getIniDbBoolean("commandTimerSettings","active"):true,m=[],s=-1,a=0,r=0;function o(){var e=$.inidb.GetKeyList("commandTimer",""),n;m=[];for(n in e){m.push(e[n])}$.consoleLn($.lang.get("commandtimer.console.loaded",m.length));return m.length}function d(){t=!t;$.setIniDbBoolean("commandTimerSettings","active",t);return t}function g(){i=!i;$.setIniDbBoolean("commandTimerSettings","randomize",i);return i}function c(e){$.setIniDbBoolean("commandTimer",e,true);return o()}function l(e){$.inidb.del("commandTimer",e);return o()}$.bind("ircChannelMessage",function(t){var o=$.systemTime(),d;if(t.getSender().equalsIgnoreCase($.botName)){return}++a;if(a>=e){if(o>r+n*1e3){a=0;r=o+n*1e3;if(i){do{d=$.rand(m.length-1)}while(d==s)}else{if(s+1>=m.length){d=0}else{d=s+1}}s=d;Packages.me.mast3rplan.phantombot.event.EventBus.instance().post(new Packages.me.mast3rplan.phantombot.event.command.CommandEvent($.botName,m[d],""))}}});$.bind("command",function(e){var m=e.getSender(),s=e.getCommand(),a=e.getArgs(),r=a[0],o;if(s.equalsIgnoreCase("addcommandtimer")){if(!r){$.say($.whisperPrefix(m)+$.lang.get("commandtimer.add.usage"));return}c(r);$.say($.whisperPrefix(m)+$.lang.get("commandtimer.add.success",r));return}if(s.equalsIgnoreCase("delcommandtimer")){if(!r){$.say($.whisperPrefix(m)+$.lang.get("commandtimer.del.usage"));return}l(r);$.say($.whisperPrefix(m)+$.lang.get("commandtimer.del.success",r));return}if(s.equalsIgnoreCase("commandtimer")){if(r.equalsIgnoreCase("toggle")){d();$.say($.whisperPrefix(m)+$.lang.get("commandtimer.toggle.success",t?$.lang.get("common.enabled"):$.lang.get("common.disabled")));return}if(r.equalsIgnoreCase("togglerandom")){g();$.say($.whisperPrefix(m)+$.lang.get("commandtimer.togglerandom.success",i?$.lang.get("common.enabled"):$.lang.get("common.disabled")));return}if(r.equalsIgnoreCase("settime")){o=parseInt(a[1]);if(!a[1]||isNaN(o)){$.say($.whisperPrefix(m)+$.lang.get("commandtimer.settime.usage"));return}n=o;$.inidb.set("commandTimerSettings","intervalSec",o);$.say($.whisperPrefix(m)+$.lang.get("commandtimer.settime.success",o));return}if(r.equalsIgnoreCase("setreqmsgs")){o=parseInt(a[1]);if(!a[1]||isNaN(o)){$.say($.whisperPrefix(m)+$.lang.get("commandtimer.setreqmsgs.usage"));return}n=o;$.inidb.set("commandTimerSettings","requiredMsgs",o);$.say($.whisperPrefix(m)+$.lang.get("commandtimer.setreqmsgs.success",o))}}});$.bind("initReady",function(){if($.bot.isModuleEnabled("./systems/commandTimer.js")){o();$.registerChatCommand("./systems/commandTimer.js","addcommandtimer",1);$.registerChatCommand("./systems/commandTimer.js","delcommandtimer",1);$.registerChatCommand("./systems/commandTimer.js","commandtimer",1)}})})();