(function(){var e=$.inidb.exists("subscribeHandler","subscribeMessage")?$.inidb.get("subscribeHandler","subscribeMessage"):"(name) just subscribed!",s=$.inidb.exists("subscribeHandler","reSubscribeMessage")?$.inidb.get("subscribeHandler","reSubscribeMessage"):"(name) just subscribed for (months) months in a row!",r=$.inidb.exists("subscribeHandler","subscriberWelcomeToggle")?$.getIniDbBoolean("subscribeHandler","subscriberWelcomeToggle"):true,i=$.inidb.exists("subscribeHandler","reSubscriberWelcomeToggle")?$.getIniDbBoolean("subscribeHandler","reSubscriberWelcomeToggle"):true,n=parseInt($.inidb.exists("subscribeHandler","subscribeReward"))?parseInt($.inidb.get("subscribeHandler","subscribeReward")):0;$.bind("twitchSubscribesInitialized",function(){if(!$.bot.isModuleEnabled("./handlers/subsribeHandler.js")){return}$.consoleLn(">> Enabling subscriber announcements")});$.bind("twitchSubscribe",function(e){if(!$.bot.isModuleEnabled("./handlers/subsribeHandler.js")){return}var s=e.getSubscriber();if(!$.inidb.exists("subscribed",s)){$.inidb.set("subscribed",s,"true")}else if(n>0&&$.bot.isModuleEnabled("./core/pointSystem.js")){$.inidb.incr("points",s,n)}});$.bind("twitchUnsubscribe",function(e){if(!$.bot.isModuleEnabled("./handlers/subsribeHandler.js")){return}var s=e.getSubscriber();if($.inidb.exists("subscribed",s)){$.inidb.del("subscribed",s)}});$.bind("command",function(i){var b=i.getSender(),a=i.getCommand(),t=i.getArguments().trim(),u=i.getArgs();if(a.equalsIgnoreCase("subwelcometoggle")){if(!$.isAdmin(b)){$.say($.whisperPrefix(b)+$.adminMsg);return}if(r){$.inidb.set("subscribeHandler","subscriberWelcomeToggle",false);r=false;$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.new.sub.toggle.off"));return}else{$.inidb.set("subscribeHandler","subscriberWelcomeToggle",true);r=true;$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.new.sub.toggle.on"));return}}if(a.equalsIgnoreCase("reSubwelcometoggle")){if(!$.isAdmin(b)){$.say($.whisperPrefix(b)+$.adminMsg);return}if(r){$.inidb.set("subscribeHandler","reSubscriberWelcomeToggle",false);r=false;$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.resub.toggle.off"));return}else{$.inidb.set("subscribeHandler","reSubscriberWelcomeToggle",true);r=true;$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.resub.toggle.on"));return}}if(a.equalsIgnoreCase("submessage")){if(!$.isAdmin(b)){$.say($.whisperPrefix(b)+$.adminMsg);return}else if(u.length==0){$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.sub.msg.usage"));return}$.inidb.set("subscribeHandler","subscribeMessage",t);e=t;$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.sub.msg.set"));return}if(a.equalsIgnoreCase("resubmessage")){if(!$.isAdmin(b)){$.say($.whisperPrefix(b)+$.adminMsg);return}else if(u.length==0){$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.resub.msg.usage"));return}$.inidb.set("subscribeHandler","reSubscribeMessage",t);s=t;$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.resub.msg.set"));return}if(a.equalsIgnoreCase("subscribereward")){if(!$.isAdmin(b)){$.say($.whisperPrefix(b)+$.adminMsg);return}else if(u.length==0){$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.reward.usage"));return}$.inidb.set("subscribeHandler","subscribeReward",parseInt(u[0]));n=parseInt(u[0]);$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.reward.set"));return}if(a.equalsIgnoreCase("subscribercount")){if(!$.isAdmin(b)){$.say($.whisperPrefix(b)+$.adminMsg);return}var d=$.inidb.GetKeyList("subscribed",""),l=0,g;for(g=0;g<d.length;g++){l++}$.say($.whisperPrefix(b)+$.lang.get("subscribehandler.sub.count",l))}});$.bind("ircPrivateMessage",function(b){var a=b.getSender(),t=b.getMessage(),u=e,d=s,l=t.substring(0,t.indexOf(" ",1)).toString();if(a.equalsIgnoreCase("twitchnotify")){if(t.contains("just subscribed!")&&r){u=u.replace(/\(name\)/gi,l);u=u.replace("/(reward)/ig",n);$.say(u);return}if(t.contains("months in a row!")&&t.contains("subscribed for")&&i){var g=t.substring(t.indexOf("months")-3,t.indexOf("months")-1).toString();d=d.replace("/(name)/ig",l);d=d.replace("/(months)/ig",g);d=d.replace("/(reward)/ig",n);$.say(d)}}});$.bind("initReady",function(){if($.bot.isModuleEnabled("./handlers/subscribehandler.js")){$.registerChatCommand("./handlers/subscribehandler.js","subwelcometoggle",2);$.registerChatCommand("./handlers/subscribehandler.js","reSubwelcometoggle",2);$.registerChatCommand("./handlers/subscribehandler.js","subscribereward",2);$.registerChatCommand("./handlers/subscribehandler.js","subscribecount",2);$.registerChatCommand("./handlers/subscribehandler.js","submessage",2);$.registerChatCommand("./handlers/subscribehandler.js","resubmessage",2)}})})();